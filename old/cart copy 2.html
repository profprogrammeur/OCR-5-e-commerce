<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>CART</title>
  </head>
  <body>
    <h1 id="para">CART</h1>
    <img id="pics" />

    <ul id="ul"></ul>

    <!-- <ul id="ul"></ul> -->
    <input type="submit" value="Submit" />
  </body>
  <script>
    ////get nproduct number from URL
    let url = new URL(window.location.href);
    const params = new URLSearchParams(url.search);
    const _id = params.get("_id");
    const option = params.get("option");
    const h2num = document.getElementById("h2num");
    let count = 0;
    const para = document.getElementById("para");
    const ul = document.getElementById("ul");
    var response = "";
    const pics = document.getElementById("pics");
    let cart = JSON.parse(localStorage.getItem("cart"));

    // var request = new XMLHttpRequest();
    // var request2 = new XMLHttpRequest();

    //  function displ2(el) {
    //     count += 1;
    //     request2.open("GET", "http://localhost:3000/api/cameras/" + el);
    //     request2.send();
    //   };

    // displ(cart[0]._id);
    // displ2(cart[1]._id);

    // function cb (el) {
    //   count += 1;
    //   request.open("GET", "http://localhost:3000/api/cameras/" + el._id);
    //   request.send();
    // }

    // var request = new XMLHttpRequest();

    function displ(el) {
      // count += 1;
      request.open("GET", "http://localhost:3000/api/cameras/" + el);
      request.send();
    }
    var data;
    requests = new Array(cart.length);

       function loop () {
    for (let i = 0; i < cart.length; i++) {
      var url2 = "http://localhost:3000/api/cameras/" + cart[i]._id;
      requests[i] =  new XMLHttpRequest();

       
    
       

      requests[i].open("GET", url2);
      // await checkNumProduct(i);
      requests[i].onload =    function() {
        data = JSON.parse(requests[i].responseText);
        console.log(data);
        // if (count == (document.getElementsByTagName("li").length / 5))
        // {count += 1;
        createListElements(data)
        // ;}
        // createListElement(data.name);
        // createListElement(data.lenses[option]);
        // createListElement(data.price + " €");
        // createListElement(count);
        // createListElement("-----------------");
      };
              
      //    requests[i].onreadystatechange = async function () {
      //   if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
           
      //   }
      // }  

        requests[i].send();
    }
    }
loop();

//  async function checkNumProduct (k){
//   if (k != (document.getElementsByTagName("li").length / 5))
//  return null 
// }

function createListElements (el){
  createListElement(el.name);
  createListElement(el.lenses[option]);
  createListElement(el.price + " €");
  createListElement(count);
  createListElement("-----------------");

}

    // requests.onreadystatechange = function() {
    //   if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
    //     // response = JSON.parse(this.responseText);
    //     createListElement(data.name);
    //     createListElement(data.lenses[option]);
    //     createListElement(data.price + " €");
    //     createListElement(count);
    //   }
    // };
    // displ(cart[0]._id);
    // cart.forEach(el => {
    //         var request = new XMLHttpRequest();

    //     count += 1;
    //     request.open("GET", "http://localhost:3000/api/cameras/" + el._id);
    //     request.send();
    //   });

    // request.onreadystatechange = function() {
    //   if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
    //     response = JSON.parse(this.responseText);
    //     createListElement(response.name);
    //     createListElement(response.lenses[option]);
    //     createListElement(response.price + " €");
    //     createListElement(count);

    //   }
    // };
    function createListElement(el) {
      var li = document.createElement("li"); // creates an element "li"
      li.appendChild(document.createTextNode(el)); //makes text from input field the li text
      ul.appendChild(li);
    }
    // request2.onreadystatechange = function () {
    //   if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
    //     response = JSON.parse(this.responseText);
    //     createListElement(response.name);
    //     createListElement(response.lenses[option]);
    //     createListElement(response.price + " €");
    //     createListElement(count);

    //   }
    // };

    // const getInfo = async (id)=> {

    // }
    // const displayCart = async() => {

    // }

    // function promiseForEach(cart, cb) {
    //     var i = 0;

    //     var nextPromise = function () {
    //       if (i >= cart.length) {
    //         // Processing finished.
    //         return;
    //       }

    //       // Process next function. Wrap in `Promise.resolve` in case
    //       // the function does not return a promise
    //       var newPromise = Promise.resolve(cb(cart[i]));
    //       i++;
    //       // Chain to finish processing.
    //       return newPromise.then(nextPromise);
    //     };

    //     // Kick off the chain.
    //     return Promise.resolve().then(nextPromise);
    //   };
    //   promiseForEach(cart, cb);
  </script>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>CART</title>
  </head>
  <body>
    <h1 id="para">CART</h1>
    <img id="pics" />
    <div id="bigDiv"></div>

    <!-- <ul id="ul"></ul> -->

    <!-- <ul id="ul"></ul> -->
    <input type="submit" value="Submit" />
  </body>
  <script>
    ////get nproduct number from URL
    let url = new URL(window.location.href);
    const params = new URLSearchParams(url.search);
    const _id = params.get("_id");
    let option = null;
    const h2num = document.getElementById("h2num");
    let count = -1;
    const para = document.getElementById("para");
    const ul = document.getElementById("ul");
    const bigDiv = document.getElementById("bigDiv");
    var response = "";
    const pics = document.getElementById("pics");
    let cart = JSON.parse(localStorage.getItem("cart"));
    let countArr = [];

    var data;
    requests = new Array(cart.length);

    // function loop () {
    const loop =  () => {
      for (let i = 0; i < cart.length; i++) {
        // await insideLoop()
        // function insideLoop (){
        var url2 = "http://localhost:3000/api/cameras/" + cart[i]._id;

        requests[i] =  new XMLHttpRequest();
          requests[i].open("GET", url2);
        // requests[i].onload =  function() {
        requests[i].onload =    function() {
          // if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
            // setTimeout(() => {
            data = JSON.parse(requests[i].responseText);
            // console.log(data);
            count = i;
            option = cart[i].option;
            countArr.push(count);
            //  console.log(countArr)
             createListElements(data, i);
            // }, 1000);
          // } else console.log("erreur : " + i)
        };

        requests[i].send();
      }
    };
    loop();

     function createListElements(el, n) {
      createListElement(el.name, n);
      createListElement(el.lenses[option], n);
      createListElement(el.price + " €", n);
      createListElement("request n° : " + count, n);
      createListElement("-----------------", n);
    }

    function createListElement(el, n) {
      var li = document.createElement("li"); // creates an element "li"
      var ul = document.createElement("ul"); // creates an element "li"
      li.appendChild(document.createTextNode(el)); //makes text from input field the li text
      ul.appendChild(li);
      bigDivArray[n].appendChild(ul);
    }

    for (let j = 0; j < cart.length; j++) {
      var div = document.createElement("div");
      bigDiv.appendChild(div);
    }

    let numero = Array.from(div.parentNode.children).indexOf(div);
    let bigDivArray = Array.from(div.parentNode.children);
  </script>
</html>

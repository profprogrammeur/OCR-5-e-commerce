<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>CART</title>
  </head>
  <body>
    <h1 id="para">CART</h1>
    <img id="pics" />
    <!-- <select id="select">    
    </select> -->

    <ul id="ul"></ul>
    <!-- <p id="h2num">numéro : ...</p>
    <p id="h2price">price : ...</p>
    <p id="h2descr">description : ...</p>
    <p id="h2option">option : ...</p> -->
    <ul id="ul"></ul>
    <input type="submit" value="Submit" />
  </body>
  <script>
    ////get nproduct number from URL
    let url = new URL(window.location.href);
    const params = new URLSearchParams(url.search);
    const _id = params.get("_id");
    const option = params.get("option");
    const h2num = document.getElementById("h2num");
    let count=0;
    //LOCALSTORAGE
    // localStorage.setItem("item", "Smith");

    var response = "";
    var request = new XMLHttpRequest();
    const pics = document.getElementById("pics");
    request.onreadystatechange = function() {
      if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
        response = JSON.parse(this.responseText);

        function createListElement(el) {
          var li = document.createElement("li"); // creates an element "li"
          li.appendChild(document.createTextNode(el)); //makes text from input field the li text
          ul.appendChild(li);
        }
        createListElement(response.name);
        createListElement(response.lenses[option]);
        createListElement(response.price + " €");
        createListElement(count );

        // console.log("lenses : " + response[1].lenses);
        // console.log("voilà : "+response.lenses);
        // pics.src = response.imageUrl;
        // pics.style.height = "50px";
        // h2price.textContent = "NAME : " + response.name;
        // h2descr.textContent = "DESCRIPTION: " + response.description;
        // h2num.textContent = "PRICE : " + response.price + " $";
        // h2option.textContent = "OPTION : " + response.lenses[option];

        // display CART
        function displayCart(el) {}
        function displayCart(el) {}

        // cart.forEach(el => {displayCart(el)
        // });

        //Get the first key name of a javascript object = option
        // const option = Object.keys(response)[0];
        // const options = response[Object.keys(response)[0]];
        // h2option.textContent = option + " : " + response.lenses;

        // response[0].name;
        // options.forEach(item => createListElement(item));
      }
    };

    // request.open("GET", "http://localhost:3000/api/cameras/" + _id);
    let cart = JSON.parse(localStorage.getItem("cart"));
     cart.forEach(el => {
      //  request.onreadystatechange = function () {
      //   if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
      //     response = JSON.parse(this.responseText);

      //     function createListElement(el) {
      //       var li = document.createElement("li"); // creates an element "li"
      //       li.appendChild(document.createTextNode(el)); //makes text from input field the li text
      //       ul.appendChild(li);
      //     }
      //     createListElement(response.name);
      //     createListElement(response.lenses[option]);
      //     createListElement(response.price + " €");
      //     createListElement(" ");}}
      count +=1;
      request.open("GET", "http://localhost:3000/api/cameras/" + el._id);
      request.send();
    });

    // request.open("GET", "http://localhost:3000/api/cameras/");

    const para = document.getElementById("para");
    const ul = document.getElementById("ul");
    // para.textContent = response[0];
  </script>
</html>
